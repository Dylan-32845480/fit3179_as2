{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "data": {"url": "https://github.com/Dylan-32845480/fit3179_as2/blob/7af33fb237b413ae6e75ce1b1e1c137c06f61bb0/data/2023_AirportPassengerData.csv"},
    "width": 350,
    "height": 400,
    "title": {
        "text": "Passengers by passenger type in 2023",
        "fontSize": 25,
        "color": "#0d0155",
        "dy": -5
    },
    "params": [
        {
            "name": "travel_select",
            "bind": {
                "input": "select",
                "options": [
                    null,
                    "KLIA",
                    "PULAU PINANG",
                    "KOTA KINABALU",
                    "KUCHING",
                    "LANGKAWI",
                    "JOHOR BAHRU",
                    "KOTA BHARU",
                    "IPOH",
                    "KUALA TERENGGANU",
                    "ALOR SETAR",
                    "MELAKA",
                    "SUBANG",
                    "KUANTAN",
                    "TIOMAN",
                    "REDANG",
                    "LABUAN",
                    "LAHAD DATU",
                    "SANDAKAN",
                    "TAWAU",
                    "BINTULU",
                    "MIRI",
                    "SIBU",
                    "MULU",
                    "LIMBANG",
                    "MUKAH"
                ], "labels":[
                    "Show All",
                    "KLIA",
                    "PULAU PINANG",
                    "KOTA KINABALU",
                    "KUCHING",
                    "LANGKAWI",
                    "JOHOR BAHRU",
                    "KOTA BHARU",
                    "IPOH",
                    "KUALA TERENGGANU",
                    "ALOR SETAR",
                    "MELAKA",
                    "SUBANG",
                    "KUANTAN",
                    "TIOMAN",
                    "REDANG",
                    "LABUAN",
                    "LAHAD DATU",
                    "SANDAKAN",
                    "TAWAU",
                    "BINTULU",
                    "MIRI",
                    "SIBU",
                    "MULU",
                    "LIMBANG",
                    "MUKAH"
                ],  
                "name": "Airport Selection: "
            }
        }
    ],
    
    "transform": [
        {
          "fold": ["Domestic Arrivals", "International Arrivals", "Domestic Departures", "International Departures"],
          "as": ["measure", "value"]
        },
        {
          "filter": "datum.value > 0"
        },
        {
            "filter": "travel_select == null || travel_select == datum.Airports"
        },
        {
            "calculate": "datum.value / datum.Total_TOTAL",
            "as": "percentage"
        },
        {
            "filter": "datum.percentage > 0.01"
        }
    ],
    "encoding": {
        "y": {
            "field": "Airports",
            "type": "nominal",
            "title": "Airport"
        },
        "x": {
            "aggregate": "sum",
            "field": "value",
            "type": "quantitative",
            "title": "Percentage of total passengers",
            "stack":  "normalize",
            "axis": {
                "format": "%"
            }
        },
        "color": {
            "legend": {
                "orient": "none",
                "legendX": 375
            }
        }
    },
    "layer": [
        {
            "mark": {
                "type": "bar",
                "stroke": "black"
            },
            "params": [
                {
                    "name": "highlight",
                    "select": {
                        "type": "point",
                        "on": "mouseover",
                        "clear": "mouseout"
                    }
                }
            ],
            "encoding": {
                "color": {
                    "field": "measure",
                    "type": "nominal",
                    "scale": {
                        "domain": ["Domestic Arrivals", "Domestic Departures", "International Arrivals", "International Departures"],
                        "range": ["#0072B2", "#D95F02", "#009E73", "#CC79A7"]
                    },
                    "title": "Passenger Type",
                    "legend": {
                        "direction": "vertical",
                        "orient": "right",
                        "labelFontSize": 11,
                        "labelColor": "#414142",
                        "labelFontWeight": "bold",
                        "titleFontSize": 15,
                        "titlePadding": 10
                    }
                },
                "strokeWidth": {
                    "condition":
                    {
                        "param": "highlight",
                        "empty": false,
                        "value": 2.5
                    },
                    "value": 0.5
                },
                "tooltip": [
                    {
                    "field": "measure",
                    "type": "nominal",
                    "title": "Type of air travel"
                    },
                    {
                    "field": "value",
                    "type": "quantitative",
                    "title": "Number of passengers"
                    },
                    {
                        "field": "percentage",
                        "type": "quantitative",
                        "title": "Percentage of total passengers",
                        "format": ".0%"
                    }
                ]
            }
        },
        {
            "mark": {
                "type": "text",
                "dx": 0,
                "align": "center",
                "fontSize": 10,
                "fontWeight": "bolder"
            },
            "transform": [
                {
                    "filter": "datum.percentage > 0.05"
                }
            ],
            
            "encoding": {
                "x": {
                    "aggregate": "sum", "field": "value",
                    "stack":  "normalize",
                    "bandPosition": 0.5
                },
                "text": {
                    "aggregate": "sum", "field": "percentage",
                    "format": ".0%"
                },
                "detail": {
                    "field": "measure"
                },
                "color": {"value":"#F0F0F0"},
                "tooltip": [
                    {
                    "field": "measure",
                    "type": "nominal",
                    "title": "Type of air travel"
                    },
                    {
                    "field": "value",
                    "type": "quantitative",
                    "title": "Number of passengers"
                    },
                    {
                        "field": "percentage",
                        "type": "quantitative",
                        "title": "Percentage of total passengers",
                        "format": ".0%"
                    }
                ]
            }
        }
    ]
}